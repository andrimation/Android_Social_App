#: import MapView kivy_garden.mapview.MapView
#:import MapMarkerPopup kivy_garden.mapview.MapMarkerPopup
#:import MapViewImp MapViewImp.MapViewImp
#:import MapViewBackground MapViewBackground.MapViewBackground
#:import ImageButton ImageButton.ImageButton
#:import AsyncImageButton ImageButton.ImageButton
#:import MDTextFieldInput MDTextFieldMessageBubble.MDTextFieldMessageBubble

ScreenManager:
    LoginScreen
    CreatePostScreen
    PostScreen
    MainScreen
    UserScreen
    CurrentThreadMessagesScreen
#    RegisterScreen
    PhotosGalleryScreen
    TransitionScreen

<LoginScreen>:
    id:LoginScreen
    name: 'LoginScreen'
    # Zaminieć to video na animację po prostu screenów.

#    MapViewImp:
#        id: BackgroundMap
#        lat:53.428
#        lon:14.527
#        zoom: 15
#        double_tap_zoom: True
#        root_property: root
#        __init__: root.create_animation()
#        on_zoom: root.nothing()
#        on_touch_down: root.nothing()
#        pause_on_action: False

#    Video:
#        id: background1
#        pos_hint: {"y":-1.5,"x":-1}
#        pos: -1,-1
#        size_hint_y: 4
#        size_hint_x:3.2
#        source:"video_.avi"
#        state: "play"
#        options: {'allow_stretch': True,'eos': 'loop'}
#        allow_fullscreen: True
#        fullscreen: True

    MDCard:
        id: MainLoginCard
        size_hint: 0.95,0.8
        pos_hint: {"center_x":0.5,"center_y":0.5}
        elevation: 30
        padding: 25
        spacing: 25
        opacity: 0.5

    MDTextField
        id: userName
        hint_text: "username"
        size_hint_x: None
        width: MainLoginCard.width *0.7
        pos_hint: {"center_x":0.5,"center_y":0.50}

    MDTextField
        id: userPassword
        hint_text: "password"
        size_hint_x: None
        width: MainLoginCard.width *0.7
        pos_hint: {"center_x":0.5,"center_y":0.42}
        password: True

    MDFillRoundFlatButton
        id: LoginButton
        size_hint_x: None
        width: MainLoginCard.width *0.6
        elevation: 8
        text: "Login"
        pos_hint: {"center_x":0.5,"center_y":0.28}
        md_bg_color: 0.3,0.7,0.7
        on_press: root.check_credentails()

    MDFillRoundFlatButton
        id: RegisterButton
        size_hint_x: None
        width: MainLoginCard.width *0.6
        text: "Register"
        pos_hint: {"center_x":0.5,"center_y":0.18}
        md_bg_color: 0.2,0.5,1
        on_press: root.register_user()



<RegisterScreen>
    id:RegisterScreen
    name: 'RegisterScreen'
#    MapViewImp:
#        id: BackgroundMap
#        lat: 53.428
#        lon: 14.527
#        zoom: 15
#        double_tap_zoom: True
#        root_property: root
#        __init__: root.create_animation()
#        on_zoom: root.nothing()
#        on_touch_down: root.nothing()
#        pause_on_action: False


#    Video:
#        id: background2
#        pos: -1,-1
#        size_hint_y: 4
#        size_hint_x:3.2
#        source:"video_.avi"
#        allow_stretch:True
#        keep_ratio: False
#        state: "play"
#        options: {'allow_stretch': True,'eos': 'loop'}
#        allow_fullscreen: True
#        fullscreen: True
#        pos_hint: {"y":-1.5,"x":-1}
    MDCard:
        id: MainLoginCard
        size_hint: 0.95,0.95
        pos_hint: {"center_x":0.5,"center_y":0.5}
        elevation: 30
        padding: 25
        spacing: 25
        opacity: 0.5

    MDTextField:
        id: username
        hint_text: "Login *"
        size_hint_x: None
        width: MainLoginCard.width *0.7
        pos_hint: {"center_x":0.5,"center_y":0.85}

    MDTextField:
        id: user_password
        hint_text: "Password *"
        size_hint_x: None
        width: MainLoginCard.width *0.7
        pos_hint: {"center_x":0.5,"center_y":0.75}

    MDTextField:
        id: first_name
        hint_text: "First name *"
        size_hint_x: None
        width: MainLoginCard.width *0.7
        pos_hint: {"center_x":0.5,"center_y":0.65}

    MDTextField:
        id: second_name
        hint_text: "Second name *"
        size_hint_x: None
        width: MainLoginCard.width *0.7
        pos_hint: {"center_x":0.5,"center_y":0.55}

    MDTextField:
        id: age
        hint_text: "Age *"
        input_filter: "int"
        size_hint_x: None
        width: MainLoginCard.width *0.7
        pos_hint: {"center_x":0.5,"center_y":0.45}

    MDTextField:
        id: email
        hint_text: "E-mail adress *"
        size_hint_x: None
        width: MainLoginCard.width *0.7
        pos_hint: {"center_x":0.5,"center_y":0.35}

    MDTextField:
        id: phone
        hint_text: "Phone number"
        input_filter: "int"
        size_hint_x: None
        width: MainLoginCard.width *0.7
        pos_hint: {"center_x":0.5,"center_y":0.25}

    MDFillRoundFlatButton
        id: RegisterButton
        size_hint_x: None
        size_hint_y: 0.07
        width: MainLoginCard.width *0.6
        text: "Register"
        pos_hint: {"center_x":0.5,"center_y":0.16}
        md_bg_color: 0.2,0.5,1
        on_press: root.register_new_user()

    MDIconButton:
        id: BackToMainScreen
        icon: "arrow-left-thick"
        pos_hint: {"x":0.03,"y":0.03}
        on_release: root.back_to_login()
<Item>
    IconLeftWidget:
        icon: root.left_icon



<MainScreen>:
    name: 'MainScreen'
    MapViewImp:
        id: MainMap
        lat:53.448
        lon:14.537
        zoom: 12
        double_tap_zoom: True
        root_property: root
        on_zoom: root.zoom_update(self)
        pause_on_action: True
#        size_hint_y: 0.9
#        pos_hint: {"y":0.1}
#        on_touch_down: self.do_update(0)



    MDToolbar:
        id: topToolbar
        pos_hint: {"top":1}
        right_action_items: [["account-circle",lambda x: root.show_my_profile(),"My Profile","My Profile"]]
        opacity: 1
        elevation: 0
        type_height: "large"


    MDToolbar:
        id: bottomToolbar
        left_action_items: [["dots-vertical",lambda x: root.open_menu(),"Open menu"],["bell-ring-outline",lambda x: root.show_notifications_dialog(),"Pokaż powiadomienia","Pokaż powiadomienia"],["android-messages",lambda x: root.display_all_messages_threads()]]
        right_action_items: [["account-group",lambda x: root.show_allUsers_dialog(),"Przeglądaj użytkowników","Przeglądaj użytkowników"],["message-question-outline",lambda x: root.show_allPosts_dialog(),"Przeglądaj posty","Przeglądaj posty"],["message-plus-outline",lambda x: root.create_post(),"Dodaj post","Dodaj post"]]
        opacity: 1
        elevation: 0


<PostScreen>:
    id: PostScreen
    name: "PostScreen"
#    Image:
#        id: Background_image_post
#        source: "xxx.png"
#        size: (root.size[0],root.size[1])
#        allow_stretch: True
#        keep_ratio: False
#
#    MDToolbar:
#        opacity: 1
#        pos_hint: {"top":1}
#        right_action_items:[["trash-can-outline", lambda x: root.delete_post(), "Delete post", "Delete post"]]
#
#    GridLayout:
#        rows: 7
#        cols: 1
#        spacing: 10
#        pos_hint: {"x": 0.1, "center_y": 0.49}
#        size_hint_y: 0.7
#        size_hint_x: 0.8
#        height: root.height *0.8  # make smaller than Label to force scrolling
#        MDLabel:
#            pos_hint: {"x": 0.05, "y": 1}
#            size_hint_y: 0.05
#            theme_text_color: "Custom"
#            text_color: 0.2,0.5,1
#            text: root.displayUserAndDate
#
#        AsyncImageButton:
#            id: postImage
#            source: ""
#            size_hint_x:1
#            size_hint_y:1
#            size: 0,0
#            opacity: 0
#            on_release: root.display_post_gallery()
#        MDFillRoundFlatIconButton:
#            id: postTextBubble
#            on_release: root.display_owner_menu(root.postOwnerData)
#
#        MDGridLayout:
#            id: contentGridLayout
#            cols: 1
#            rows: 2
#
#
#    MDToolbar:
#        type: "top"
#        opacity: 1
#        left_action_items:[["arrow-left-thick", lambda x: root.back_to_main_screen(back_to_main=True),"Wróć","Wróć"]]
#        right_action_items:[["message-reply-text-outline", lambda x: root.comment_post(), "Odpowiedz", "Odpowiedz"]]


<AlertDialogContent>
    size_hint_y: None
    size: app.get_running_app().windowSize[0]*0.7,app.get_running_app().windowSize[1]*0.7
    GridLayout:

        cols: 1
        rows: 2
        spacing: 10
        MDLabel:
            font_size: "25sp"
            text: " Czy na pewno chcesz dodać post alarmowy ?"
            theme_text_color: "Custom"
            text_color: 1,1,1
        MDLabel:
            text: "       Post alarmowy spowoduje powiadomienie wszystkich użytkowników w promieniu kilometra. \n\n - Pamiętaj że możesz użyć postu alarmowego tylko raz w tygodniu. \n\n - W razie potrzeby możesz jednak wykupić dodatkowe posty alarmowe."
            theme_text_color: "Custom"
            text_color: 1,1,1
            adaptive_height: True

<PlaceInfoDialogContent>
    size_hint_y: None
    size: app.get_running_app().windowSize[0]*0.7,app.get_running_app().windowSize[1]*0.3
    GridLayout:

        cols: 1
        rows: 2
        spacing: 10
        MDLabel:
            font_size: "18sp"
            text: " To choose your Home/Work localization, double tap on map. \n\n Remember, you can set your Home/Work localization only once a month! "
            theme_text_color: "Custom"
            text_color: 1,1,1

<PostTimeDialogContent>
    orientation: "vertical"
    spacing: "12dp"
    size_hint_y: None
    height: "120dp"

    MDTextField:
        id: hours
        hint_text: "Hours ?"
        multiline: False
#        input_filter: "int"

    MDTextField:
        id: minutes
        hint_text: "Minutes ?"
        multiline: False
#        input_filter: "int"

<DistanceDialogContent>
    orientation: "vertical"
    spacing: "12dp"
    size_hint_y: None
    height: "50dp"

    MDTextField:
        id: hours
        multiline: False
        input_filter: "int"


<CreatePostScreen>
    name: "CreatePostScreen"
#    Image:
#        id: Background_image_post
#        source: "xxx.png"
#        size: (root.size[0],root.size[1])
#        allow_stretch: True
#        keep_ratio: False

#    MDToolbar:
#        pos_hint: {"top":1}
#    GridLayout:
#        id: MainGridLayout
#        cols: 1
#        rows: 2
#        pos_hint: {"x": 0.1, "center_y": 0.49}
#        size_hint_y: 0.8
#        size_hint_x: 0.8
#        ImageButton:
#            source: None
#            id: ImageToSend
#            size_hint_y: None
#            size_hint_x: None
#            size: 0,0
#
#        BoxLayout:
#            id: MainBoxLayout
#            spacing: 10
#            pos_hint: {"x": 0.1, "center_y": 0.49}
#            size_hint_y: 0.7
#            size_hint_x: 0.8
#            height: root.height *0.8  # make smaller than Label to force scrolling
#            MDTextField:
#                id: textField
#                hint_text: "Wpisz post"
#                pos_hint: {"x":0.5,"y":0.5}
#                multiline: True
#                theme_text_color: "Custom"
#                line_color_focus: 0.2,0.5,1
#                line_color_normal: 0.2,0.5,1
#                text_color: 0,0,0
#
#    MDToolbar:
#        type: "top"
#        left_action_items:[["arrow-left-thick",lambda x: root.back_to_main_screen(),"Wróć","Wróć"]]
#        right_action_items:[["currency-usd",lambda x: root.mark_post_as_sell(),"Mark post as sell","Mark post as sell"],["clock-time-three-outline",lambda x: root.set_post_time(),"Czas wyświetlania postu","Czas wyświetlania postu"],["bell-alert-outline",lambda x: root.alert_post(),"Post alarmowy","Post alarmowy"],["camera-plus-outline",lambda x:root.add_photo(),"Dodaj zdjęcia","Dodaj zdjęcia"],["send", lambda x: root.send_post(), "Wyślij", "Wyślij"]]

<PreviewAllPostsItem>
    ImageLeftWidget:
        source: root.source

<PreviewAllUsersItem>
    ImageLeftWidget:
        source: root.source

<MenuIconListItem>
    IconLeftWidget:
        icon: root.icon

<ShowMoreUsersItem>
    ImageLeftWidget:
        source: root.source

<users_post_Choose_dialog>
    ImageLeftWidget:
        source: root.source

<FriendsRequestItem>
    ImageLeftWidget:
        source: root.source

<PreviewMessagesThreadsItem>
    ImageLeftWidget:
        source: root.source

<UserScreen>
    id: UserScreen
    name: "UserScreen"

    Image:
        id: Background_image_user
        source: "xxx.png"
        size: (root.size[0],root.size[1])
        allow_stretch: True
        keep_ratio: False


    MDToolbar:
        pos_hint: {"top":1}
        title: root.username

    FloatLayout:
        size_hint_y: 0.8
        rows: 4
        cols: 1
        AsyncImageButton:
            id: profileImage
            elevation: 4
            source: "person.png"
            pos_hint: {"y":0.3}
            size_hint_x: 1
            size_hint_y: 1
            FloatLayout:
                AsyncImageButton:
                    opacity: 0
                    id: profilePhoto
                    source: "person.png"
                    elevation: 10
                    size_hint_y: None
                    size_hint_x: None
                    keep_ratio: False
                    allow_stretch: True
                    size: 400,400
                    pos: ((profileImage.pos[0]+profileImage.size[0]/2)-profilePhoto.size[0]/2,profileImage.pos[1]+profileImage.size[1]/2-profilePhoto.size[1]/2)
                    on_press: root.changeProfileImage()
                    canvas:
                        Color:
                            rgba: 0.2,0.5,1,0.8
                        Line:
                            width: 5.
                            ellipse: (profilePhoto.pos[0],profilePhoto.pos[1],profilePhoto.size[0],profilePhoto.size[0])

        MDFloatingActionButton:
            icon: "message"
            icon_size: "128sp"
            size: 80,80
            pos_hint: {"x":0.125,"y":0.35}
            text: ""
            on_release: root.send_private_message()

        MDFloatingActionButton:
            icon: "account-plus" if root.friends == False else "account-check"
            pos_hint: {"x":0.325,"y":0.35}
            text: ""
            on_release: root.send_friends_request() if root.friends == False else root.display_remove_friends_dialog()

        MDFloatingActionButton:
            icon: "camera"
            pos_hint: {"x":0.525,"y":0.35}
            text: ""
            on_release: root.open_user_gallery()

        MDFloatingActionButton:
            icon: "archive"
            pos_hint: {"x":0.725,"y":0.35}
            text: ""

        MDFloatingActionButton:
            icon: "account-group"
            pos_hint: {"x":0.325,"y":0.20}
            text: ""
            on_release: root.display_all_users_friends()

    MDToolbar:
        type: "top"
        left_action_items:[["arrow-left-thick", lambda x: root.back_to_main_screen(back_to_main=True),"Wróć","Wróć"]]
        right_action_items:[["logout", lambda x: root.logout(),"Logout","Logout"]]



<CurrentThreadMessagesScreen>
    name: "CurrentThreadMessagesScreen"

    Image:
        id: Background_image
        source: "xxx.png"
        size: (root.size[0],root.size[1])
        allow_stretch: True
        keep_ratio: False

    MDToolbar:
        pos_hint: {"top":1}
        right_action_items:[["page-previous",lambda x: root.download_full_conversation(),"Preview full conversation","Preview full conversation"],["trash-can-outline", lambda x: root.delete_conversation(), "Delete conversation", "Delete conversation"]]

    BoxLayout:
        id: BoxLayoutID
        pos_hint: {"x":0.05,"y":0.2}
        size_hint: 0.9,0.70
        ScrollView:
            id: messagesScrollView
            size_hint_y: 0.9
            pos_hint: {"y":0.05}
            do_scroll_y: True
            do_scroll_x: False
            MDGridLayout:
                id: photosGridLayout
                cols: 1
#                row_default_height: (self.width - self.cols*self.spacing[0]) / self.cols
#                row_force_default: True
                adaptive_height: True
                padding: dp(10), dp(10)
                spacing: dp(15)
                height: self.minimum_height


    MDTextFieldInput:
        id: MessageTextField
        icon_right: "comment-text"
        background_color: 0,0,0,0
        text_color: 0,0,1,1
        multiline: True
        hint_text: "Wpisz wiadomosć"
        pos_hint: {"x":0.1,"y":0.12}
        size_hint_x: 0.8
        line_color_normal: 0.2,0.5,1


#    MDTextField:
#        id: MessageTextField
#        icon_right: "comment-text"
#        size_hint_x: 0.1
#        pos_hint: {"x":0.05,"y":0.2}
#        hint_text: "Wpisz wiadomosć"



    MDToolbar:
        type: "top"
        id: messagesBottomToolbar
        left_action_items:[["arrow-left-thick", lambda x: root.back_to_main_screen(),"Wróć","Wróć"]]
        right_action_items:[["camera-plus", lambda x: root.ask_if_add_photo(), "add_photo", "add_photo"],["send", lambda x: root.send_message(), "Wyślij", "Wyślij"]]


<PhotosGalleryScreen>
    name: "PhotosGalleryScreen"

    MDToolbar:
        pos_hint: {"top":1}

    ScrollView:
        id: photosScrollView
        size_hint_y: 0.8
        pos_hint: {"y":0.1}
#        do_scroll_y: False
#        do_scroll_x: True
        MDGridLayout:
            id: photosGridLayout
            cols: 2
            row_default_height: (self.width - self.cols*self.spacing[0]) / self.cols
            row_force_default: True
            adaptive_height: True
            padding: dp(4), dp(4)
            spacing: dp(4)


    MDToolbar:
        type: "top"
        left_action_items:[["arrow-left-thick", lambda x: root.back_to_user_screen(),"Wróć","Wróć"]]
        right_action_items: [["image-plus", lambda x: root.add_photo_to_gallery(),"Add photo","Add photo"]]

<PhotoGalleryDialogContent>
    orientation: "vertical"
    spacing: "12dp"
    size_hint_y: None
    height: "120dp"
    elevation: 5
    MDTextField:
        id: photoComment
        multiline: True
        max_lines: 4
        hint_text: "Add photo description \nor leave blank: "

<TransitionScreen>
    name: "TransitionScreen"
    MDToolbar:
        pos_hint: {"top":1}

    MDToolbar:
        type: "top"

